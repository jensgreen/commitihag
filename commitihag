#!/bin/bash

set -euo pipefail

now="$(date +%s)"
lastcheck="$(stat -f %m ~/.commitihag)"

if [ $((now - lastcheck)) -gt $((24 * 60 * 60)) ]; then
	# More than 24h since last check
	gitdir=~/.dotfiles
	if [ -n "$(git -C "$gitdir" status --porcelain)" ]; then
	   # Convert /home/$USER/... to ~/...
	   pushd "$gitdir" > /dev/null
	   gitdir_pretty=$(dirs +0)
	   popd > /dev/null

	   echo "❌ $gitdir_pretty contains uncommitted changes"
	fi

	# Set last checked time (= now) as mtime
	touch -m -t "$(date -r "$now" +%Y%m%d%H%M.%S)" ~/.commitihag
fi
